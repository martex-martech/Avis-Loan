{% extends "core/base.html" %}
{% load static %}

{% block title %}Dashboard - Loan App{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 50;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 16px 20px;
        background-color: var(--primary);
        color: white;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .header-title {
        font-size: 20px;
        font-weight: 600;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
    }

    .header-actions a {
        color: white;
        font-size: 18px;
        padding: 4px;
        transition: transform 0.2s;
    }


    .dashboard-container {
        position: absolute;
        top: 80px;
        bottom: 80px;
        left: 0;
        right: 0;
        overflow-y: auto;
        padding: 16px;
    }

    .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
    }

    .dashboard-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .dashboard-card h3 {
        font-size: 1.1rem;
        margin: 0;
        color: var(--text);
    }

    .dashboard-card p {
        font-size: 1.8rem;
        margin: 8px 0 0;
        font-weight: 700;
        color: var(--primary);
    }

    .section {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: var(--shadow);
        margin-bottom: 20px;
    }

    .section h2 {
        font-size: 1.2rem;
        margin-bottom: 12px;
        font-weight: 600;
        color: var(--text);
    }

    .recent-activities ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .recent-activities li {
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
        font-size: 0.95rem;
        color: var(--text-light);
    }

    /* Bottom Navbar Styles */
    .nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: white;
        padding: 0.75rem 0;
        z-index: 40;
        box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .nav-items {
        display: flex;
        justify-content: space-around;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--text-light);
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        text-decoration: none;
    }

    .nav-item i {
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
    }

    .nav-item.active {
        color: var(--primary);
    }
</style>
{% endblock %}

{% block content %}
<header class="header">
    <div class="text-lg font-semibold">Staff Dashboard</div>
</header>

<div class="dashboard-container">
    <!-- Summary Cards -->
    <div class="dashboard-cards">
        <div class="dashboard-card">
            <h3>Active Agents</h3>
            <p>{{ active_agents }}</p>
        </div>
        <div class="dashboard-card">
            <h3>Loans Initiated</h3>
            <p>{{ loans_initiated }}</p>
        </div>
        <div class="dashboard-card">
            <h3>Total Expense</h3>
            <p>â‚¹{{ total_expense }}</p>
        </div>
    </div>

    <!-- Recent Activities -->
    <div class="section recent-activities">
        <h2>Recent Activities</h2>
        <ul>
            {% for activity in recent_activities %}
            <li>{{ activity }}</li>
            {% empty %}
            <li>No recent activity</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Users Joined Trend Graph -->
    <div class="section">
        <h2>Agent Joined Trend</h2>
        <canvas id="usersJoinedChart" height="120"></canvas>
    </div>
</div>

<!-- Bottom Navbar -->
<nav class="nav">
    <div class="nav-items">
        <a href="{% url 'staff_dashboard' %}" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="{% url 'staff_userManagement' %}" class="nav-item">
            <i class="fas fa-users"></i>
            <span>Users</span>
        </a>
        <a href="{% url 'payments' %}" class="nav-item">
            <i class="fas fa-money-bill-wave"></i>
            <span>Payments</span>
        </a>
        <a href="{% url 'staff_reports' %}" class="nav-item">
            <i class="fas fa-chart-line"></i>
            <span>Reports</span>
        </a>
        <a href="{% url 'staff_settings' %}" class="nav-item">
            <i class="fas fa-user-cog"></i>
            <span>Settings</span>
        </a>
    </div>
</nav>

<script>
    const ctx = document.getElementById('usersJoinedChart').getContext('2d');
    const usersJoinedChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: JSON.parse('{{ trend_labels|safe }}'),
            datasets: [{
                label: 'Agents Joined',
                data: JSON.parse('{{ trend_data|safe }}'),
                borderColor: '#28485d',
                backgroundColor: 'rgba(40, 72, 93, 0.1)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' }
            }
        }
    });
</script>
{% endblock %}